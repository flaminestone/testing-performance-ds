<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' type="text/css" href='public/stylesheets/style.css' />
     <script type="text/javascript" src="public/javascript/database.js"></script>
    <link href="public/javascript/lib/tabulator/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="public/javascript/lib/tabulator/js/tabulator.min.js"></script>
  </head>
  <body>
  <div class="space">
    <div class="navigation">
      <a href="/">test</a>
    </div>
    <div class="info">
      <div class="action-form">
        <div class="user_form">
          <input placeholder="User name" id="username">
        </div>
        <button onclick="loading()">Load data</button>
      </div>
    </div>
  </div>
  <div id="table"></div>

  </body>
</html>

<script>
  if (localStorage.getItem('username') !== '') {
    document.getElementById('username').value = localStorage.getItem('username');
  }

  //define data
  Database.get_results(localStorage.getItem('username')).then(results => {
    let averagedResults = []
    console.log(results)
    console.log(JSON.parse(results))
    JSON.parse(results).forEach(x => {
      averagedResults.push({filename: x.filename,
        count: x.time.length,
        average: x.time.reduce((a,b) => a + b, 0) / x.time.length,
        max: Math.max(...x.time),
        min: Math.min(...x.time)})
    })

    new Tabulator("#table", {
      data:averagedResults,
      autoColumns:true,
    });
  });


  // console.log(tabledata1)
  // var tabledata = [
  //   {id:1, name:"Oli Bob", location:"United Kingdom", gender:"male", rating:1, col:"red", dob:"14/04/1984"},
  //   {id:2, name:"Mary May", location:"Germany", gender:"female", rating:2, col:"blue", dob:"14/05/1982"},
  //   {id:3, name:"Christine Lobowski", location:"France", gender:"female", rating:0, col:"green", dob:"22/05/1982"},
  //   {id:4, name:"Brendon Philips", location:"USA", gender:"male", rating:1, col:"orange", dob:"01/08/1980"},
  //   {id:5, name:"Margret Marmajuke", location:"Canada", gender:"female", rating:5, col:"yellow", dob:"31/01/1999"},
  //   {id:6, name:"Frank Harbours", location:"Russia", gender:"male", rating:4, col:"red", dob:"12/05/1966"},
  //   {id:7, name:"Jamie Newhart", location:"India", gender:"male", rating:3, col:"green", dob:"14/05/1985"},
  //   {id:8, name:"Gemma Jane", location:"China", gender:"female", rating:0, col:"red", dob:"22/05/1982"},
  //   {id:9, name:"Emily Sykes", location:"South Korea", gender:"female", rating:1, col:"maroon", dob:"11/11/1970"},
  //   {id:10, name:"James Newman", location:"Japan", gender:"male", rating:5, col:"red", dob:"22/03/1998"},
  // ];
  //
  // //define table
  // var table = new Tabulator("#table", {
  //   data:tabledata,
  //   autoColumns:true,
  // });
  // table.tabulator("setData", tabledata);

  function loading() {
        console.log(Database.get_results(document.getElementById('username').value))
    }
</script>